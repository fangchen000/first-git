<include file="./Lingshow/Home/View/Public/header.html" />
<include file="./Lingshow/Home/View/Public/dq.html" />
<!--注册开始-->
<script src="__PUBLIC__/admin/assets/js/jquery-1.11.1.min.js"></script>
<div class="zhuce">
     <h2>海之澜会员注册</h2>
     <form name="zc" action="{:U('Qtdz/qtzc')}" method="post">
       <p><label><span>*</span>账号：</label><input name="zhangh" type="text" placeholder="格式为数字字母下划线 长度为4位以上"></p>
       <p><label><span>*</span>真实姓名：</label><input name="zxxm" type="text"></p>
       <p><label><span>*</span>手机：</label><input name="phone" maxlength="11" type="text"></p>
       <p><label><span></span>邮箱：</label><input name="email" type="email"></p>
       <p><label><span>*</span>推荐人账号：</label><input name="tj" type="text"></p>
         <!--sx ds xs-->
       <p><label><span>*</span>地区：</label><script type="text/javascript" src="__PUBLIC__/yes1/js/area.js"></script><script type="text/javascript" src="__PUBLIC__/yes1/js/location.js"></script><script type="text/javascript" src="__PUBLIC__/yes1/js/select2.js"></script><script type="text/javascript" src="__PUBLIC__/yes1/js/select2_locale_zh-CN.js"></script><link rel="stylesheet" href="__PUBLIC__/yes1/css/common.css"/><link rel="stylesheet" href="__PUBLIC__/yes1/css/select2.css"/><select name="sx"  id="loc_province" style="width:120px;"></select><select name="ds"  id="loc_city" style="width:120px; margin-left: 10px"></select><select name="xs"  id="loc_town" style="width:120px;margin-left: 10px"></select></p>
       <p><label><span>*</span>详细地址：</label><textarea name="xiangx" cols="35%;" rows="4" ></textarea>
       <p><label><span>*</span>密码：</label><input name="mm" type="password">
           <!--<b class="">请设置密码（6-20位）</b>-->
       </p>
       <p><label><span>*</span>再次输入密码：</label><input name="mm1" type="password"><b style="display: none;" class="mmtx">两次密码不一致</b></p>
       <p class="yanzheng"><label><span>*</span>验证码：</label><input name="yzm" type="text"><img style="cursor:pointer;width:20%;height:40px;margin-left:1%;" class="verifyimg reloadverify" alt="点击切换" src="{:U('verify')}" ></p>
       <p class="tong"><input name="xy" type="checkbox"><i>我已阅读并同意<a href="##">《海之澜用户注册协议》</a></i></p>
     </form>
    <form>

       <p class="zhuce_btn"><input  type="button" value="立即注册"></p>
    </form>
</div>
<script>
    $(function(){
        $('input[name=zhangh]').val('');$('textarea[name=xiangx]').val('');$('input[name=zxxm]').val('');$('input[name=phone]').val('');$('input[name=email]').val('');$('input[name=tj]').val('');$('input[name=mm]').val('');$('input[name=mm1]').val('');$('input[name=yzm]').val('');$('select[name=sx]').val('');$('select[name=ds]').val('');$('select[name=xs]').val('');
        $('input[name=zhangh]').removeAttr('disabled');$('textarea[name=xiangx]').attr('disabled','true');$('input[name=zxxm]').attr('disabled','true');$('input[name=phone]').attr('disabled','true');$('input[name=email]').attr('disabled','true');$('input[name=tj]').attr('disabled','true');$('input[name=mm]').attr('disabled','true');$('input[name=mm1]').attr('disabled','true');$('input[name=yzm]').attr('disabled','true');$('select[name=sx]').attr('disabled','true');$('select[name=ds]').attr('disabled','true'); $('select[name=xs]').attr('disabled','true');

        $('input[name=zhangh]').keyup(function(){var a= $(this).val().replace(/\W/g,'');$('input[name=zhangh]').val(a);})
        $('input[name=phone]').keyup(function(){var a= $(this).val().replace(/\D/g,'');$('input[name=phone]').val(a);})
        $('input[name=yzm]').keyup(function(){var a= $(this).val().replace(/\W/g,'');$('input[name=yzm]').val(a);})
        $('input[name=tj]').keyup(function(){var a= $(this).val().replace(/\W/g,'');$('input[name=tj]').val(a);})
        $('input[name=mm]').change(function(){
            $('.mmtx').hide();
        })
        $('input[name=zhangh]').blur(function(){
            var zhangh= $('input[name=zhangh]').val();
            var zhanghlen= $('input[name=zhangh]').val().length;
            if(zhanghlen > 4){
            $.post("{:U('Qtdz/userpd')}",{
                zhangh:zhangh
            },function(data){
               if(data==9){
                   $('input[name=zhangh]').attr('disabled','true');
                   $('input[name=zxxm]').removeAttr('disabled');
                   $('textarea[name=xiangx]').removeAttr('disabled');
                   $('input[name=phone]').removeAttr('disabled');
                   $('input[name=email]').removeAttr('disabled');
                   $('input[name=tj]').removeAttr('disabled');
                   $('input[name=mm]').removeAttr('disabled');
                   $('input[name=mm1]').removeAttr('disabled');
                   $('input[name=yzm]').removeAttr('disabled');
                   $('select[name=sx]').removeAttr('disabled');
                   $('select[name=ds]').removeAttr('disabled');
                   $('select[name=xs]').removeAttr('disabled');
                   alert('请填写推荐人账号');
               }else{
                   alert('账户已经存在不能注册');
               }
            })
            }else{
                alert('账户长度不够');
            }
        })

        $('input[name=tj]').blur(function(){
            var zhangh= $('input[name=tj]').val();
            $.post("{:U('Qtdz/userpd')}",{
                zhangh:zhangh
            }, function (data) {
                if(data==-1){
                    $('input[name=tj]').attr('disabled','true');
                    alert('推荐人正确 请完善注册');
                }else{
                alert('推荐人不存在不能注册');
                }
            })
        })

        $('.zhuce_btn').click(function(){
            var zhangh =  $('input[name=zhangh]').val();
            var xiangx = $('textarea[name=xiangx]').val();
            var zxxm = $('input[name=zxxm]').val();
            var phone = $('input[name=phone]').val();
            var  email  =$('input[name=email]').val();
            var tj  = $('input[name=tj]').val();
            var mm = $('input[name=mm]').val();
            var mm1 = $('input[name=mm1]').val();
            var yzm = $('input[name=yzm]').val();
            var sx = $('select[name=sx]').val();
            var ds = $('select[name=ds]').val();
            var xs = $('select[name=xs]').val();
            if(!zxxm ||!phone ||!email||!tj||!yzm||!sx||!ds ||!xiangx){alert('以上内容*不能有空值');}else{
              if(mm!=mm1 || mm.length<5 || !mm1){$('.mmtx').show();alert('密码不一致 长度不够5位');}else {
                  if ($('input[name=xy]').is(':checked')) {
                          $.post("{:U('Qtdz/verify')}",{
                              code:yzm
                          },function(data){
                              if(data==1){  $('input[name=zhangh]').removeAttr('disabled'); $('input[name=tj]').removeAttr('disabled');$("form[name=zc]").submit();}else{
                                 alert('验证码错误');
                                  $('.verifyimg').trigger('click');
                              }
                          })
                  } else {
                      alert('请签署用户协议');
                  }
              }
            }
        })
        var verifyimg = $(".verifyimg").attr("src");
        $(".reloadverify").click(function(){
            if( verifyimg.indexOf('?')>0){
                $(".verifyimg").attr("src", verifyimg+'&random='+Math.random());
            }else{
                $(".verifyimg").attr("src", verifyimg.replace(/\?.*$/,'')+'?'+Math.random());
            }
        });
    })

</script>
<!--注册结束-->
<include file="./Lingshow/Home/View/Public/footer.html" />